<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EmojiPick â€” My Picks</title>
  <link rel="stylesheet" href="styles.v11.css" />
  <style>
    .pageWrap{max-width:980px;margin:22px auto;padding:0 16px;}
    .headerRow{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:14px;}
    .brand{display:flex;align-items:center;gap:10px;}
    .brand .logo{width:34px;height:34px;display:grid;place-items:center;border-radius:12px;background:#f3f4f6;}
    .brand h1{font-size:18px;margin:0;line-height:1.1;}
    .brand p{margin:2px 0 0 0;font-size:12px;opacity:.7;}
    .btn{border:1px solid rgba(0,0,0,.12);background:#fff;border-radius:999px;padding:8px 12px;font-weight:600;cursor:pointer;}
    .btn:active{transform:translateY(1px)}
    .card{border:1px solid rgba(0,0,0,.12);border-radius:18px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.05);}
    .cardHeader{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin:0 0 10px 0;}
    .cardTitle{margin:0;font-size:24px;}
    .muted{opacity:.7;font-size:13px;}
    .pickList{display:flex;flex-direction:column;gap:12px;margin-top:14px;}
    .pickItem{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 14px;}
    .pickLeft{min-width:0;}
    .pickLine1{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
    .tag{font-size:12px;font-weight:700;padding:4px 10px;border-radius:999px;background:#f3f4f6;}
    .emojis{font-size:18px;letter-spacing:2px;}
    .nums{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
    .ball{width:34px;height:34px;border-radius:999px;display:grid;place-items:center;border:1px solid rgba(0,0,0,.12);font-weight:800;}
    .ball.pb{border-color:rgba(124,58,237,.45);background:rgba(124,58,237,.08)}
    .footerRow{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:16px;flex-wrap:wrap;}
    .linkRow a{margin-right:10px;}
  </style>
</head>
<body>
  <div class="pageWrap">
    <div class="headerRow">
      <div class="brand">
        <div class="logo">âœ¨</div>
        <div>
          <h1>EmojiPick</h1>
          <p>Your saved picks (this device)</p>
        </div>
      </div>
      <button class="btn" onclick="location.href='index.html'">Back</button>
    </div>

    <div class="card" style="padding:18px;">
      <div class="cardHeader">
        <div>
          <h2 class="cardTitle">Saved Picks</h2>
          <div class="muted">Stored locally in your browser (localStorage).</div>
        </div>
        <button id="clearAllBtn" class="btn">Clear all</button>
      </div>

      <div id="emptyState" class="muted" style="display:none;">No picks saved yet. Go back and generate one, then click <b>Save</b>.</div>
      <div id="list" class="pickList"></div>
    </div>

    <div class="footerRow">
      <div class="linkRow">
        <a href="privacy.html">Privacy policy</a>
        <a href="terms.html">Terms and Conditions</a>
      </div>
      <div class="muted">Build v26</div>
    </div>
  </div>

<script>
(()=>{
  const LS_KEY = 'emojipick_picks_v1';

  // Keep in sync with index page (app.v11.js)
  const EMOJIS = [
    {c:'lucky',e:'ðŸ€'},{c:'lucky',e:'âœ¨'},{c:'lucky',e:'ðŸŒŸ'},{c:'lucky',e:'ðŸŒˆ'},{c:'lucky',e:'ðŸ”¥'},
    {c:'money',e:'ðŸ’Ž'},{c:'money',e:'ðŸ§²'},{c:'money',e:'ðŸ’°'},{c:'money',e:'ðŸ¦'},{c:'money',e:'ðŸª™'},
    {c:'fun',e:'ðŸ¥³'},{c:'fun',e:'ðŸŽ­'},{c:'fun',e:'ðŸŽ²'},{c:'fun',e:'ðŸŽ¯'},{c:'fun',e:'ðŸŽ'},
    {c:'animals',e:'ðŸ¦Š'},{c:'animals',e:'ðŸ¼'},{c:'animals',e:'ðŸ¦'},{c:'animals',e:'ðŸ¸'},{c:'animals',e:'ðŸ¬'},
    {c:'nature',e:'ðŸŒ¸'},{c:'nature',e:'ðŸ¦‹'},{c:'nature',e:'ðŸ„'},{c:'nature',e:'ðŸ¦…'},{c:'nature',e:'ðŸ‹'},
    {c:'all',e:'ðŸ‘ï¸'},{c:'all',e:'ðŸª„'},{c:'all',e:'ðŸ§ '},{c:'all',e:'ðŸ§¿'},{c:'all',e:'ðŸ”®'},
    {c:'all',e:'ðŸ§¸'},{c:'all',e:'ðŸª½'},{c:'all',e:'ðŸŒ™'},{c:'all',e:'â­'},{c:'all',e:'ðŸ•¯ï¸'},
    {c:'all',e:'ðŸ«¶'},{c:'all',e:'ðŸ’›'}
  ];

  const GAME_NAME = {
    'powerball':'Powerball',
    'mega':'Mega Millions',
    'tx':'TX Instant (Demo)'
  };

  const $list = document.getElementById('list');
  const $empty = document.getElementById('emptyState');
  const $clearAll = document.getElementById('clearAllBtn');

  function load(){
    try { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); }
    catch { return []; }
  }
  function save(arr){
    localStorage.setItem(LS_KEY, JSON.stringify(arr));
  }

  function normalizePick(p){
    // v16 supports both legacy and new schema
    const gameId = p.gameId || p.game || p.draw || 'powerball';
    const dateSeed = p.dateSeed || p.date || p.when || '';

    const idxs = p.emojiIdxs || p.idxs || p.emojisIdxs || [];
    const emojis = (p.emojis && Array.isArray(p.emojis))
      ? p.emojis
      : (Array.isArray(idxs) ? idxs.map(i => (EMOJIS[i] ? EMOJIS[i].e : 'â“')) : []);

    const main = (p.nums && Array.isArray(p.nums.main)) ? p.nums.main
               : (Array.isArray(p.numbers) ? p.numbers : (p.mainNumbers || p.main || []));

    const bonus = (p.nums && (p.nums.bonus !== undefined && p.nums.bonus !== null)) ? p.nums.bonus
                : (p.powerball ?? p.pb ?? p.bonus ?? null);

    return {
      gameId,
      gameName: GAME_NAME[gameId] || String(gameId),
      dateSeed,
      emojis,
      main,
      bonus
    };
  }

  function sortKey(raw){
    // Newest first: savedAt (ISO) -> id prefix (millis) -> 0
    if (raw && raw.savedAt) {
      const t = Date.parse(raw.savedAt);
      if (!Number.isNaN(t)) return t;
    }
    if (raw && typeof raw.id === 'string') {
      const m = raw.id.match(/^(\d{10,})-/);
      if (m) {
        const n = Number(m[1]);
        if (!Number.isNaN(n)) return n;
      }
    }
    return 0;
  }

  function render(){
    const arr = load();
    $list.innerHTML = '';

    if (!arr.length){
      $empty.style.display = 'block';
      return;
    }
    $empty.style.display = 'none';

    const sorted = arr.map((raw, idx) => ({ raw, idx }))
      .sort((a,b) => sortKey(b.raw) - sortKey(a.raw));

    sorted.forEach(({raw, idx}) => {
      const p = normalizePick(raw);

      const item = document.createElement('div');
      item.className = 'card pickItem';

      const left = document.createElement('div');
      left.className = 'pickLeft';

      const line1 = document.createElement('div');
      line1.className = 'pickLine1';
      line1.innerHTML = `
        <span class="tag">${escapeHtml(p.gameName)}</span>
        <span class="muted">${escapeHtml(p.dateSeed || '')}</span>
        <span class="emojis">${p.emojis.map(escapeHtml).join(' ')}</span>
      `;

      const nums = document.createElement('div');
      nums.className = 'nums';

      (p.main || []).forEach(n => {
        const b = document.createElement('div');
        b.className = 'ball';
        b.textContent = String(n);
        nums.appendChild(b);
      });
      if (p.bonus !== null && p.bonus !== undefined && p.bonus !== ''){
        const pb = document.createElement('div');
        pb.className = 'ball pb';
        pb.textContent = String(p.bonus);
        nums.appendChild(pb);
      }

      left.appendChild(line1);
      left.appendChild(nums);

      const right = document.createElement('div');
      const del = document.createElement('button');
      del.className = 'btn';
      del.textContent = 'Delete';
      del.addEventListener('click', () => {
        const next = load();
        next.splice(idx, 1);
        save(next);
        render();
      });
      right.appendChild(del);

      item.appendChild(left);
      item.appendChild(right);
      $list.appendChild(item);
    });
  }

  $clearAll.addEventListener('click', () => {
    if (!confirm('Delete all saved picks from this device?')) return;
    save([]);
    render();
  });

  function escapeHtml(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#039;');
  }

  render();
})();
</script>
</body>
</html>
